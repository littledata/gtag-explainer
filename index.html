<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GTag Payload Viewer</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }

    #main {
      display: flex;
      flex-direction: row;
      height: calc(100% - 200px); /* Keep room at bottom for explanations */
    }

    #jsonContainer {
      flex: 0 0 30%;
      border-right: 1px solid #ccc;
      box-sizing: border-box;
      padding: 8px;
    }

    #jsonInput {
      width: 100%;
      height: 70vh; /* about 70% of the viewport height */
      box-sizing: border-box;
    }

    #tableContainer {
      flex: 1;
      padding: 8px;
      box-sizing: border-box;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      text-align: left;
      border: 1px solid #ccc;
      padding: 6px;
    }

    .info-icon {
      cursor: pointer;
      margin-left: 8px;
      color: #0066cc;
    }

    #explanationArea {
      border-top: 1px solid #ccc;
      padding: 12px;
      min-height: 80px;
    }

    #errorMsg {
      color: red;
      margin-top: 8px;
    }
  </style>
</head>
<body>
<h1 style="margin: 8px;">Simple GTag Payload Viewer</h1>
<div id="main">
  <!-- Left side: JSON input -->
  <div id="jsonContainer">
    <h2>Paste GTag Payload JSON</h2>
    <textarea id="jsonInput" placeholder="Paste your GTagPayload JSON here..."></textarea>
    <br />
    <button id="parseBtn">Parse JSON</button>
    <div id="errorMsg"></div>
  </div>

  <!-- Right side: table -->
  <div id="tableContainer">
    <h2>Parsed GTag Payload</h2>
    <table>
      <thead>
      <tr>
        <th>Key / Name</th>
        <th>Value</th>
      </tr>
      </thead>
      <tbody id="payloadTbody"></tbody>
    </table>
  </div>
</div>

<!-- Bottom area: explanation panel -->
<div id="explanationArea">
  <h3>Selected Property Explanation</h3>
  <div id="explanationText">No property selected yet.</div>
</div>

<script>
  // Basic dictionary with display names & explanations. Extend as needed.
  // Key = property from GTagPayload. displayName is how it appears in the table,
  // explanation is shown in the bottom area when you click the info icon.
  const propertyExplanations = {
    v: {
      displayName: "Protocol version",
      explanation: "Protocol version used in the request, typically 2 for GA4."
    },
    tid: {
      displayName: "Tracking ID",
      explanation: "Measurement ID / GA4 tracking ID, e.g., G-XXXX."
    },
    cid: {
      displayName: "Client ID",
      explanation: "The client ID for this measurement request."
    },
    sr: {
      displayName: "Screen Resolution",
      explanation: "Indicates the user’s screen resolution."
    },
    en: {
      displayName: "Event Name",
      explanation: "The GA4 event name, e.g. page_view, add_to_cart, etc."
    }
    // ...Add more as needed from the GTagPayload definitions...
  };

  const parseBtn = document.getElementById("parseBtn");
  const jsonInput = document.getElementById("jsonInput");
  const errorMsg = document.getElementById("errorMsg");
  const payloadTbody = document.getElementById("payloadTbody");
  const explanationText = document.getElementById("explanationText");

  parseBtn.addEventListener("click", () => {
    // Clear any existing errors or table data
    errorMsg.textContent = "";
    payloadTbody.innerHTML = "";
    explanationText.textContent = "No property selected yet.";

    let parsed;
    try {
      parsed = JSON.parse(jsonInput.value);
    } catch (e) {
      errorMsg.textContent = "Invalid JSON: " + e.message;
      return;
    }

    // Build the table rows for each top-level key
    Object.keys(parsed).forEach((key) => {
      const value = parsed[key];
      const tr = document.createElement("tr");

      // Left column: property name + info icon
      const tdKey = document.createElement("td");
      tdKey.textContent = propertyExplanations[key]?.displayName || key;

      // Add an info icon next to the property name
      const infoIcon = document.createElement("span");
      infoIcon.classList.add("info-icon");
      infoIcon.textContent = "ℹ️";
      infoIcon.addEventListener("click", () => {
        const explanation = propertyExplanations[key]?.explanation ||
          "No explanation available for this property.";
        explanationText.textContent = explanation;
      });
      tdKey.appendChild(infoIcon);

      // Right column: raw value
      const tdValue = document.createElement("td");
      // If value is an object/array, show as string
      tdValue.textContent = typeof value === "object"
        ? JSON.stringify(value, null, 2)
        : value;

      tr.appendChild(tdKey);
      tr.appendChild(tdValue);
      payloadTbody.appendChild(tr);
    });
  });
</script>
</body>
</html>
